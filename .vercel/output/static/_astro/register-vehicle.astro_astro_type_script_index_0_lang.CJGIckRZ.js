import{u as m}from"./auth-store.DtDsWl_t.js";import{i as g,b as f}from"./api.BoHFqtEf.js";document.addEventListener("DOMContentLoaded",async()=>{const a=m.getState();if(!a.isAuthenticated){window.location.href="/login";return}try{const t=await g();if(typeof t=="object"&&t!==null&&"isAuthenticated"in t&&!t.isAuthenticated){console.error("La sesión de Directus ha expirado"),a.logout(),window.location.href="/login?session=expired";return}}catch(t){console.error("Error al verificar autenticación:",t)}const n=document.getElementById("vehicle-form"),r=document.getElementById("submit-btn"),c=document.getElementById("submit-spinner"),s=document.getElementById("submit-text"),d=document.getElementById("placa");d&&d.addEventListener("input",function(t){const e=t.target;e.value=e.value.toUpperCase().replace(/[^A-Z0-9]/g,"")}),n?.addEventListener("submit",async t=>{t.preventDefault(),r instanceof HTMLButtonElement&&(r.disabled=!0),c?.classList.remove("hidden"),s&&(s.textContent="Registrando..."),window.hideMessages();try{if(!n)throw new Error("Formulario no encontrado");const e=new FormData(n),l=["placa","tipo"];for(const i of l)if(!e.get(i))throw new Error(`El campo ${i} es requerido`);const o=e.get("placa");if(o&&typeof o=="string"&&(o.length<5||o.length>7))throw new Error("La placa debe tener entre 5 y 7 caracteres");const u=e.get("tipo");if(typeof o=="string"&&typeof u=="string"){const i=await f(o,u);window.showSuccessMessage("¡Vehículo registrado exitosamente!")}else throw new Error("Los valores de placa y tipo deben ser cadenas de texto");n.reset(),setTimeout(()=>{window.location.href="/user/dashboard"},2e3)}catch(e){console.error("Error registering vehicle:",e),e.message&&(e.message.includes("sesión")||e.message.includes("autenticación")||e.message.includes("token"))?(window.showErrorMessage("Tu sesión ha expirado. Serás redirigido para iniciar sesión nuevamente."),setTimeout(()=>{m.getState().logout(),window.location.href="/login?session=expired"},2e3)):window.showErrorMessage(e.message||"Error al registrar el vehículo. Por favor, intenta de nuevo.")}finally{r instanceof HTMLButtonElement&&(r.disabled=!1),c?.classList.add("hidden"),s&&(s.textContent="Registrar Vehículo")}})});
